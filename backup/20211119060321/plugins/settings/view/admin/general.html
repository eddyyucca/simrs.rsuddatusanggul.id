<article class="row">
    <form action="{?=url(ADMIN.'/settings/saveGeneral')?}" method="POST" enctype="multipart/form-data">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Umum</h3>
                </div>
            	<div class="panel-body">
                    <div class="form-group">
                        <label>Logo</label>
                        <div>
                          <img src="{?=url()?}/{$settings.logo}" width="96" height="96" class="img-thumbnail" id="logoPreview" style="cursor:pointer;" onclick="$('input[name=logo]').click()" />
                          <input type="file" name="logo" class="form-control hidden" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nama Instansi</label>
                        <input type="text" name="nama_instansi" class="form-control" value="{$settings.nama_instansi}" required />
                    </div>
                    <div class="form-group">
                        <label>Alamat</label>
                        <input type="text" name="alamat" class="form-control" value="{$settings.alamat}" required />
                    </div>
                    <div class="form-group">
                        <label>Kota/Kabupaten</label>
                        <input type="text" name="kota" class="form-control" value="{$settings.kota}" required />
                    </div>
                    <div class="form-group">
                        <label>Propinsi</label>
                        <input type="text" name="propinsi" class="form-control" value="{$settings.propinsi}" required />
                    </div>
                    <div class="form-group">
                        <label>Nomor Telepon</label>
                        <input type="text" name="nomor_telepon" class="form-control" value="{$settings.nomor_telepon}" required />
                    </div>
                    <div class="form-group">
                        <label>E-Mail</label>
                        <input type="text" name="email" class="form-control" value="{$settings.email}" required />
                    </div>
                    <div class="form-group">
                        <label>Website</label>
                        <input type="text" name="website" class="form-control" value="{$settings.website}" required />
                    </div>
                    <div class="form-group">
                        <label>Halaman depan</label>
                        <select name="homepage" class="form-control" data-use-search="true">
                            {loop: $settings.pages}
                            <option value="{$value.slug}" {if: $settings.homepage == $value.slug}selected{/if}>{$value.title} ({$value.slug})</option>
                            {/loop}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tema Admin</label>
                        <select name="theme_admin" class="form-control" onchange="change_theme(this,'theme_admin');" >
                            <option value="">Pilih tema</option>
                            <option value="cerulean"{if: $settings.theme_admin == 'cerulean'} selected{/if}>Cerulean</option>
                            <option value="cosmo"{if: $settings.theme_admin == 'cosmo'} selected{/if}>Cosmo</option>
                            <option value="cyborg"{if: $settings.theme_admin == 'cyborg'} selected{/if}>Cyborg</option>
                            <option value="darkly"{if: $settings.theme_admin == 'darkly'} selected{/if}>Darkly</option>
                            <option value="flatly"{if: $settings.theme_admin == 'flatly'} selected{/if}>Flatly</option>
                            <option value="journal"{if: $settings.theme_admin == 'journal'} selected{/if}>Journal</option>
                            <option value="lumen"{if: $settings.theme_admin == 'lumen'} selected{/if}>Lumen</option>
                            <option value="paper"{if: $settings.theme_admin == 'paper'} selected{/if}>Paper</option>
                            <option value="readable"{if: $settings.theme_admin == 'readable'} selected{/if}>Readable</option>
                            <option value="sandstone"{if: $settings.theme_admin == 'sandstone'} selected{/if}>Sandstone</option>
                            <option value="simplex"{if: $settings.theme_admin == 'simplex'} selected{/if}>Simplex</option>
                            <option value="slate"{if: $settings.theme_admin == 'slate'} selected{/if}>Slate</option>
                            <option value="spacelab"{if: $settings.theme_admin == 'spacelab'} selected{/if}>Spacelab</option>
                            <option value="superhero"{if: $settings.theme_admin == 'superhero'} selected{/if}>Superhero</option>
                            <option value="united"{if: $settings.theme_admin == 'united'} selected{/if}>United</option>
                            <option value="yeti"{if: $settings.theme_admin == 'yeti'} selected{/if}>Yeti</option>
                        </select>
                        <br><br>
                        <img id="theme_admin" src="{?=url()?}/assets/img/{$settings.theme_admin}.png" width="400">
                    </div>
                    <div class="form-group">
                        <label>Zona waktu</label>
                        <select name="timezone" class="form-control" data-use-search="true">
                            {loop: $settings.timezones}
                            <option value="{$key}" {if: $settings.timezone == $key}selected{/if}>{$value}</option>
                            {/loop}
                        </select>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Lain-lain</h3>
                </div>
                <div class="panel-body">
                    {if: $settings.master}
                    {if: $settings.module_rawat_igd}
                    <div class="form-group">
                        <label>IGD</label>
                        <select name="igd" class="form-control" data-use-search="true">
                            {loop: $settings.poliklinik}
                            <option value="{$value.kd_poli}" {if: $settings.igd == $value.kd_poli}selected{/if}>{$value.nm_poli}</option>
                            {/loop}
                        </select>
                    </div>
                    {/if}
                    {if: $settings.module_laboratorium}
                    <div class="form-group">
                        <label>Laboratorium</label>
                        <select name="laboratorium" class="form-control" data-use-search="true">
                            {loop: $settings.poliklinik}
                            <option value="{$value.kd_poli}" {if: $settings.laboratorium == $value.kd_poli}selected{/if}>{$value.nm_poli}</option>
                            {/loop}
                        </select>
                    </div>
                    <div class="form-group {if: empty($settings.module_laboratorium)}hidden{/if}">
                        <label>Penanggung Jawab Laboratorium</label>
                        <select name="pj_laboratorium" class="form-control" data-use-search="true">
                            {loop: $settings.dokter}
                            <option value="{$value.kd_dokter}" {if: $settings.pj_laboratorium == $value.kd_dokter}selected{/if}>{$value.nm_dokter}</option>
                            {/loop}
                        </select>
                    </div>
                    {/if}
                    {if: $settings.module_radiologi}
                    <div class="form-group">
                        <label>Radiologi</label>
                        <select name="radiologi" class="form-control" data-use-search="true">
                            {loop: $settings.poliklinik}
                            <option value="{$value.kd_poli}" {if: $settings.radiologi == $value.kd_poli}selected{/if}>{$value.nm_poli}</option>
                            {/loop}
                        </select>
                    </div>
                    <div class="form-group {if: empty($settings.module_radiologi)}hidden{/if}">
                        <label>Penanggung Jawab Radiologi</label>
                        <select name="pj_radiologi" class="form-control" data-use-search="true">
                            {loop: $settings.dokter}
                            <option value="{$value.kd_dokter}" {if: $settings.pj_radiologi == $value.kd_dokter}selected{/if}>{$value.nm_dokter}</option>
                            {/loop}
                        </select>
                    </div>
                    {/if}
                    {/if}
                    {if: $settings.rawat_jalan}
                    <div class="form-group">
                         <label>Antrian Rawat Jalan</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="dokter_ralan_per_dokter" value="true" {if: $settings.dokter_ralan_per_dokter == 'true'}checked{/if} /> Per Dokter
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="dokter_ralan_per_dokter" value="false" {if: $settings.dokter_ralan_per_dokter == 'false'}checked{/if} /> Per Klinik
                             </label>
                         </div>
                    </div>
                    <div class="form-group">
                         <label>Pemanggil Poli</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="responsivevoice" value="true" {if: $settings.responsivevoice == 'true'}checked{/if} /> Aktif
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="responsivevoice" value="false" {if: $settings.responsivevoice == 'false'}checked{/if} /> Tidak Aktif
                             </label>
                         </div>
                    </div>
                    {/if}
                    <div class="form-group">
                        <label>Aktifkan Cek Status Bayar</label>
                        <div class="radio">
                            <label class="radio-inline">
                               <input type="radio" name="cekstatusbayar" value="false" {if: $settings.cekstatusbayar == 'false'}checked{/if} /> Tidak
                            </label>
                            <label class="radio-inline">
                               <input type="radio" name="cekstatusbayar" value="true" {if: $settings.cekstatusbayar == 'true'}checked{/if} /> Ya
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Aktifkan Cek Limit Kuota</label>
                        <div class="radio">
                            <label class="radio-inline">
                               <input type="radio" name="ceklimit" value="false" {if: $settings.ceklimit == 'false'}checked{/if} /> Tidak
                            </label>
                            <label class="radio-inline">
                               <input type="radio" name="ceklimit" value="true" {if: $settings.ceklimit == 'true'}checked{/if} /> Ya
                            </label>
                        </div>
                    </div>
                    {if: $settings.presensi}
                    <div class="form-group">
                        <label>Aktifkan Notifikasi Presensi</label>
                        <div class="radio">
                            <label class="radio-inline">
                               <input type="radio" name="notif_presensi" value="false" {if: $settings.notif_presensi == 'false'}checked{/if} /> Tidak
                            </label>
                            <label class="radio-inline">
                               <input type="radio" name="notif_presensi" value="true" {if: $settings.notif_presensi == 'true'}checked{/if} /> Ya
                            </label>
                        </div>
                    </div>
                    {/if}
                    <div class="form-group">
                        <label>Token WhatsApp API</label> <span class="pull-right">[<a href="https://wa.basoro.id" target="_blank">Dapatkan Token Key Disini</a>]</span>
                        <input type="text" name="waapitoken" class="form-control" value="{$settings.waapitoken}" />
                    </div>
                    <div class="form-group">
                        <label>Nomor HP WhatsApp</label>
                        <input type="text" name="waapiphonenumber" class="form-control" value="{$settings.waapiphonenumber}" placeholder="62xxxxxxxxxx"/>
                    </div>
                    {if: $settings.bridging_sep}
                    <div class="form-group">
                        <label>Kode PPK BPJS</label>
                        <input type="text" name="ppk_bpjs" class="form-control" value="{$settings.ppk_bpjs}" />
                    </div>
                    <div class="form-group">
                        <label>URL API BPJS</label>
                        <input type="text" name="BpjsApiUrl" class="form-control" value="{$settings.BpjsApiUrl}" />
                    </div>
                    <div class="form-group">
                        <label>Cons ID BPJS</label>
                        <input type="text" name="BpjsConsID" class="form-control" value="{$settings.BpjsConsID}" />
                    </div>
                    <div class="form-group">
                        <label>Secret Key BPJS</label>
                        <input type="text" name="BpjsSecretKey" class="form-control" value="{$settings.BpjsSecretKey}" />
                    </div>
                    <div class="form-group">
                        <label>User Key BPJS</label>
                        <input type="text" name="BpjsUserKey" class="form-control" value="{$settings.BpjsUserKey}" />
                    </div>
                    <div class="form-group">
                         <label>Versi WS vClaim</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="vClaimVersion" value="1" {if: $settings.vClaimVersion == '1'}checked{/if} /> Versi 1.0
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="vClaimVersion" value="2" {if: $settings.vClaimVersion == '2'}checked{/if} /> Versi 1.1
                             </label>
                         </div>
                    </div>
                    {/if}
                    <div class="form-group">
                         <label>Mode Input Admin</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="admin_mode" value="simple" {if: $settings.admin_mode == 'simple'}checked{/if} /> Sederhana
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="admin_mode" value="complex" {if: $settings.admin_mode == 'complex'}checked{/if} /> Lengkap
                             </label>
                         </div>
                    </div>
                    <div class="form-group">
                         <label>Input Kasir</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="input_kasir" value="ya" {if: $settings.input_kasir == 'ya'}checked{/if} /> Ya
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="input_kasir" value="tidak" {if: $settings.input_kasir == 'tidak'}checked{/if} /> Tidak
                             </label>
                         </div>
                    </div>
                    <!--
                    <div class="form-group">
                         <label>Footer</label>
                         <input type="text" name="footer" class="form-control" value="{$settings.footer}" required />
                    </div>
                    <div class="form-group">
                         <label>Editor</label>
                         <div class="radio">
                             <label class="radio-inline">
                                <input type="radio" name="editor" value="wysiwyg" {if: $settings.editor == 'wysiwyg'}checked{/if} /> WYSIWYG
                             </label>
                             <label class="radio-inline">
                                <input type="radio" name="editor" value="html" {if: $settings.editor == 'html'}checked{/if} /> HTML
                             </label>
                         </div>
                    </div>
                    -->
                    <input type="submit" name="save" class="btn btn-primary" value="Simpan" />
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Status Aplikasi</h3>
                </div>
                <div class="panel-body">
                    <div class="text-center">
                        {if: $settings.license.type == \Systems\Lib\License::ERROR}
                        <span class="fa-stack text-danger fa-5x">
                            <i class="fa fa-circle-o fa-stack-2x"></i>
                            <i class="fa fa-times fa-stack-1x"></i>
                        </span>
                        {else}
                        <span class="fa-stack text-success fa-5x">
                            <i class="fa fa-circle-o fa-stack-2x"></i>
                            <i class="fa fa-check fa-stack-1x"></i>
                        </span>
                        {/if}
                        <h1>
                            {$settings.license.name}
                        </h1>
                        <small class="clearfix">{?=domain()?}</small>
                        {if: $settings.license.type == \Systems\Lib\License::UNREGISTERED}
                        <a href="#license-modal" data-toggle="modal" class="btn btn-primary">Upgrade</a>
                        {else}
                        <a href="{?=url([ADMIN, 'settings', 'license?downgrade'])?}" data-confirm="Apakah anda ingin menurunkan status menjadi Tidak Terdaftar?" class="btn btn-default">Downgrade</a>
                        {/if}
                        <br><br>
                        <p>Informasi tentang status aplikasi digunakan untuk kebutuhan pendataan pengguna Khanza Lite. Licensi yang dianut di perangkat lunak tetap mengacu ke <a href="https://en.wikipedia.org/wiki/Aladdin_Free_Public_License">Aladdin Free Public License</a>. Tidak ada biaya yang dikenakan atas penggunaan aplikasi ini.</p>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Informasi Sistem</h3>
                </div>
                <div class="panel-body">
                    <dl class="dl-horizontal no-margin">
                        <dt>Versi</dt>
                        <dd>{$settings.version}</dd>
                        <dt>Status</dt>
                        <dd>
                            {$settings.license.name}
                            <a href="#license-modal" data-toggle="modal" class="small">(Sunting)</a>
                        </dd>
                    </dl>
                    <hr />
                    <dl class="dl-horizontal no-margin">
                        <dt>Versi PHP</dt>
                        <dd>{$settings.system.php}</dd>
                        <dt>Versi MySQL</dt>
                        <dd>{$settings.system.mysql}</dd>
                    </dl>
                    <hr />
                </div>
            </div>
        </div>
    </form>
</article>
<div class="modal fade" id="license-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Status</h4>
            </div>
            <form method="post" action="{?=url([ADMIN,'settings','license'])?}">
                <div class="modal-body">
                    <p>Sebagai pengembang, saya ingin mengetahui jumlah pengguna Khanza LITE. Untuk itu, jika tidak berkeberatan, anda bisa mengaktifkan kode validasi penggunaan.</p>
                    <p>Anda belum terdaftar dan belum tervalidasi dalam Daftar Pengguna Aplikasi Khanza Lite. Apabila anda ingin mendapatkan layakan teknis dan bantuan saat ada perubahan (update), mintalah <a href="{?=url([ADMIN,'settings','cekdaftar'])?}" ><b>kode validasi Pendaftaran</b></a>.</p>
                    <p>Untuk mengaktifkan kode validasi pendaftaran, silahkan ketik kode validasi pendaftaran dalam isian dibawah. Anda bisa melihat kode validasi pendaftaran pada email konfirmasi <a href="{?=url([ADMIN,'settings','cekdaftar'])?}" ><b>permintaan kode validasi</b></a>.</p>
                    <input type="text" name="license-key" class="form-control" placeholder="Kode validasi..." />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-primary">Upgrade</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
  // Avatar
  var reader  = new FileReader();
  reader.addEventListener("load", function() {
    $("#logoPreview").attr('src', reader.result);
  }, false);
  $("input[name=logo]").change(function() {
    reader.readAsDataURL(this.files[0]);
  });

  var path='{?=url()?}/assets/img/';
  var img_array=new Array('','cerulean.png','cosmo.png','cyborg.png','darkly.png','flatly.png','journal.png','lumen.png','paper.png','readable.png','sandstone.png','simplex.png','slate.png','spacelab.png','superhero.png','united.png','yeti.png');

  function change_theme(obj,id){
   var i=obj.selectedIndex;
   if (i<1){ return; }
   document.getElementById(id).src=path+img_array[i];
  }
</script>

<style  type="text/css">
  html {
    font-size:16px;
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  table td {
    font-size:16px;
    padding: 0;
  }
  .cetak {
		display:inline-block;
		padding:6px 12px;
		margin:10px;
		font-size:14px;
		font-weight:400;
		line-height:1.5;
		white-space:nowrap;
    float: right;
    bottom: 10px;
    right: 10px;
	}
  .tutup {
		display:inline-block;
		padding:6px 12px;
    margin:10px;
		font-size:14px;
		font-weight:400;
		line-height:1.5;
		white-space:nowrap;
    float: right;
    bottom: 10px;
    right: 10px;
	}
  .btn {
		display:inline-block;
		padding:6px 12px;
    margin:10px;
		font-size:14px;
		font-weight:400;
		line-height:1.5;
		white-space:nowrap;
    bottom: 10px;
    right: 10px;
	}
</style>
<script>
function printContent(el){
  var restorepage = document.body.innerHTML;
  var printcontent = document.getElementById(el).innerHTML;
  document.body.innerHTML = printcontent;
  window.print();
  document.body.innerHTML = restorepage;
  window.close();
}
</script>
<body>
  {if: isset($data_sep.no_sep)}
  <div id="cetaksep">
    <table width="1000">
      <tr>
        <td>
          <table>
            <tr>
              <td width="420">
                <img src="{?=url()?}/plugins/vclaim/img/bpjslogo.png" alt="Image" width="400" height="68">
              </td>
              <td width="580">
                <div style="font-size:28px;text-align:center;font-weight:bold;">
                  SURAT ELEGIBILITAS PESERTA
                </div>
                <div style="font-size:21px;text-align:center;">
                  {$settings.nama_instansi}
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="420">
                  <b><u>{$data_sep.potensi_prb}</u></b>
              </td>
              <td width="580">
                <center>
                  <img src="{?=url()?}/systems/lib/Barcode.php?codetype=code39&size=60&text={$data_sep.no_sep}" alt="" width="200px">
                </center>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                No. SEP
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.no_sep}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Tgl. SEP
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.tglsep}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                No. Kartu
              </td>
              <td>
                :
              </td>
              <td width="450">
                {$data_sep.no_kartu} (MR: {$data_sep.nomr})
              </td>
              <td width="90">
                Peserta
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.peserta}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Nama Peserta
              </td>
              <td>
                :
              </td>
              <td width="450">
                {$data_sep.nama_pasien} ({$data_sep.jkel})
              </td>
              <td width="90">
                COB
              </td>
              <td>
                :
              </td>
              <td>
                {if: $data_sep.cob == 0}0. Tidak{else}1. Ya{/if}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Tgl. Lahir
              </td>
              <td>
                :
              </td>
              <td width="450">
                {$data_sep.tanggal_lahir}
              </td>
              <td width="90">
                Jns. Rawat
              </td>
              <td>
                :
              </td>
              <td>
                {if: $data_sep.jnspelayanan == 1}1. R. Inap{else}2. R.Jalan{/if}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                No. Telepon
              </td>
              <td>
                :
              </td>
              <td width="450">
                {$data_sep.notelep}
              </td>
              <td width="90">
                Kls. Rawat
              </td>
              <td>
                :
              </td>
              <td>
                Kelas {$data_sep.klsrawat}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Spesialis/Sub Spesialis
              </td>
              <td>
                :
              </td>
              <td width="450">
                {$data_sep.nmpolitujuan}
              </td>
              <td width="90">
                Penjamin
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.penjamin}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                DPJP Yg Melayani
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.nmdpdjp}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Faskes Perujuk
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.nmppkrujukan}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170">
                Diagnosa Awal
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.diagawal} - {$data_sep.nmdiagnosaawal}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="170" valign="top">
                Catatan
              </td>
              <td valign="top">
                :
              </td>
              <td width="550" valign="top">
                -
              </td>
              <td width="200" halign="center" valign="bottom">
                Pasien/Keluarga Pasien
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="720" height="0">
                <i style="font-size:11px;">
                  *Saya Menyetujui BPJS Kesehatan menggunakan informasi Medis Pasien jika diperlukan.<br>
                  **SEP bukan sebagai bukti penjaminan peserta<br>
                  Cetakan ke 1 {?=date('d/m/Y H:i:s')?} PM<br>
                  Masa berlaku {$data_sep.tglrujukan} s/d {$data_sep.batas_rujukan}
                </i>
              </td>
              <td valign="bottom" halign="center" padding="0" margin="0">
                <center>
                <img src="{$data_sep.qrCode}" width="100px" style="margin: -10px;"/>
                </center>
                -----------------------------------
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
  <center style="margin-top:100px;">
    <button class="tutup" type="button" onclick="javascript:window.close();opener.window.focus();">Tutup Window</button>
    <button class="cetak" onclick="printContent('cetaksep')" type="button">Cetak SEP</button>
  </center>
  {else}
    <center>
      <div class="alert alert-danger" id="sync">
        Data SEP <span id="no_sep">{?=parseURL()[2]?}</span> di server SIMRS tidak ditemukan.<br>
        Apakah akan menarik data dari v-Claim?<br>
        <button class="btn" type="button" id="syncsep">Ya</button>
        <button class="btn" type="button" onclick="javascript:window.close();opener.window.focus();">TUTUP</button>
      </div>
    </center>
    <div id="carisep">
      <pre>
      </pre>
    </div>
    <div id="caribynorujukan">
      <pre>
      </pre>
    </div>
    </div>
    <script src="{?=url()?}/assets/jscripts/jquery.min.js"></script>
    <script>
          var mlite = {token:"{$_SESSION['token']}", url:"{?=url()?}", admin:"{?=ADMIN?}"};
          $('#syncsep').on('click',function(e){
            var baseURL = mlite.url + '/' + mlite.admin;
            event.preventDefault();
            $.get("{?=url([ADMIN, 'vclaim', 'carisep', parseURL()[2]])?}", function(data){
              var data = JSON.parse(data);
              $("#carisep pre").text(JSON.stringify(data, null, '\t'));
              var json_obj = [data];
              if(!json_obj[0]) {
                alert('Koneksi ke server BPJS terputus. Silahkan ulangi lagi!');
              } else if(json_obj[0].metaData.code == 200) {

                $.get(baseURL + '/vclaim/caribynorujukan/PCare/' + json_obj[0].response.noRujukan + '?t=' + mlite.token, function(data){
                  var data = JSON.parse(data);
                  $("#caribynorujukan pre").text(JSON.stringify(data, null, '\t'));
                  var json_obj2 = [data];
                  if(!json_obj2[0]) {
                    alert('Koneksi ke server BPJS terputus. Silahkan ulangi lagi!');
                  } else if(json_obj2[0].metaData.code == 200) {
                    alert(json_obj2[0].metaData.message);

                    var no_sep = json_obj[0].response.noSep;
                    var no_rawat = '';
                    var tglsep = json_obj[0].response.tglSep;
                    var tglrujukan = json_obj2[0].response.rujukan.tglKunjungan;
                    var no_rujukan = json_obj[0].response.noRujukan;
                    var kdppkrujukan = json_obj2[0].response.rujukan.provPerujuk.kode;
                    var nmppkrujukan = json_obj2[0].response.rujukan.provPerujuk.nama;
                    var jnspelayanan = json_obj2[0].response.rujukan.pelayanan.kode;
                    var catatan = json_obj[0].response.catatan;
                    var diagawal = json_obj2[0].response.rujukan.diagnosa.kode;
                    var nmdiagnosaawal = json_obj2[0].response.rujukan.diagnosa.nama;
                    var kdpolitujuan = '';
                    var nmpolitujuan = '';
                    var klsrawat = '';
                    var lakalantas = '';
                    var user = '';
                    var nomr = '';
                    var nama_pasien = '';
                    var tanggal_lahir = '';
                    var peserta = '';
                    var jkel = '';
                    var no_kartu = json_obj2[0].response.rujukan.peserta.noKartu;;
                    var tglpulang = '';
                    var asal_rujukan = '';
                    var eksekutif = '';
                    var cob = '';
                    var penjamin = '';
                    var notelep = '';
                    var katarak = '';
                    var tglkkl = '';
                    var keterangankkl = '';
                    var suplesi = '';
                    var no_sep_suplesi = '';
                    var kdprop = '';
                    var nmprop = '';
                    var kdkab = '';
                    var nmkab = '';
                    var kdkec = '';
                    var nmkec = '';
                    var noskdp = '';
                    var kddpjp = '';
                    var nmdpdjp = '';

                    $.ajax({
                      type: "POST",
                      url: "{?=url([ADMIN,'vclaim','syncsep'])?}",
                      data: {
                        noSep: no_sep,
                        noKartu: no_kartu,
                        tglSep: tglsep
                      },
                      success: function(result){
                        var messages = result.split(' ');
                        if (messages.length == 1) {
                          //location.reload();
                        } else if(messages.length > 1) {
                          alert(result)
                        } else {
                          alert('Gagal menyimpan data ke database SIMRS');
                        }
                      }
                    });

                  } else {
                    alert(json_obj[0].metaData.message);
                  }
                });
              } else {
                alert(json_obj[0].metaData.message);
              }
            });
          });
    </script>
  {/if}
</body>

<style media="screen">
  table td,
  table th {
    padding: 5px;
  }
</style>
<style>
  .profile-card .profile-header {
    background-color: #EEE;
    padding: 42px 0;
  }
  .profile-card .profile-body .image-area {
    text-align: center;
    margin-top: -64px;
  }
  .profile-card .profile-body .image-area img {
    border: 2px solid #DDD;
    padding: 2px;
    margin: 2px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    -ms-border-radius: 50%;
    border-radius: 50%;
  }
  .profile-card .profile-body .content-area {
    text-align: center;
    border-bottom: 1px solid #ddd;
    padding-bottom: 15px;
  }
  .profile-card .profile-body .content-area p {
    margin-bottom: 0;
  }
  .profile-card .profile-body .content-area p:last-child {
    font-weight: 600;
    color: #ad1455;
    margin-top: 5px;
  }
  .profile-card .profile-footer {
    padding: 15px;
  }
  .profile-card .profile-footer ul {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  .profile-card .profile-footer ul li {
    border-bottom: 1px solid #eee;
    padding: 10px 0;
  }
  .profile-card .profile-footer ul li:last-child {
    border-bottom: none;
    margin-bottom: 15px;
  }
  .profile-card .profile-footer ul li span:first-child {
    font-weight: bold;
  }
  .profile-card .profile-footer ul li span:last-child {
    float: right;
  }
  .card-about-me .body ul {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  .card-about-me .body ul li {
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
    padding-bottom: 15px;
  }
  .card-about-me .body ul li:last-child {
    border: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }
  .card-about-me .body ul li .title {
    font-weight: bold;
    color: #666;
  }
  .card-about-me .body ul li .title i {
    margin-right: 2px;
    position: relative;
    top: 0px;
  }
  .card-about-me .body ul li .content {
    margin-top: 10px;
    color: #999;
    font-size: 13px;
  }
  .panel-post {
    -webkit-border-radius: 0;
    -moz-border-radius: 0;
    -ms-border-radius: 0;
    border-radius: 0;
  }
  .panel-post .panel-heading {
    background-color: #fff;
    -webkit-border-radius: 0;
    -moz-border-radius: 0;
    -ms-border-radius: 0;
    border-radius: 0;
  }
  .panel-post .panel-heading .media {
    margin-bottom: 0;
  }
  .panel-post .panel-heading .media a img {
    width: 42px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    -ms-border-radius: 50%;
    border-radius: 50%;
  }
  .panel-post .panel-heading .media .media-body {
    padding-top: 5px;
  }
  .panel-post .panel-heading .media .media-body h4 {
    font-size: 14px;
  }
  .panel-post .panel-heading .media .media-body h4 a {
    color: #666;
  }
  .panel-post .panel-body {
    padding: 0;
  }
  .panel-post .panel-body .post .post-heading {
    padding: 12px 15px;
  }
  .panel-post .panel-body .post .post-heading p {
    margin-bottom: 0;
  }
  .panel-post .panel-body .post .post-content {
    padding: 12px 15px;
  }
  .panel-post .panel-body .post .post-content .assessment-title {
    font-size: 14px;
  }
  .panel-post .panel-body .post .post-content ul {
    padding-left: 10px;
    margin-left: 15px;
  }
  .panel-post .panel-body .post .post-content ul li {
    list-style: bullet;
  }
  .panel-post .panel-body .post .post-content p {
    margin-bottom: 0;
  }
  .panel-post .panel-footer {
    background-color: #fff;
    border: none;
  }
  .panel-post .panel-footer ul {
    margin: 0;
    margin-top: 20px;
    padding: 0;
    padding-bottom: 5px;
    border-bottom: #eee solid 1px;
    list-style: none;
  }
  .panel-post .panel-footer ul li {
    display: inline-block;
    margin-right: 12px;
  }
  .panel-post .panel-footer ul li:last-child {
    float: right;
    margin-right: 0;
  }
  .panel-post .panel-footer ul li a {
    color: #777;
    text-decoration: none;
  }
  .panel-post .panel-footer ul li a i {
    font-size: 16px;
    position: relative;
    top: 4px;
    margin-right: 2px;
  }
  .panel-post .panel-footer ul li a span {
    font-size: 13px;
  }
  .panel-post .panel-footer .form-group {
    margin-bottom: 5px;
    margin-top: 20px;
  }
  .separator {
      display: flex;
      align-items: center;
      text-align: center;
  }
  .separator::before, .separator::after {
      content: '';
      flex: 1;
      border-bottom: 2px solid #ddd;
  }
  .separator::before {
      margin-right: .25em;
  }
  .separator::after {
      margin-left: .25em;
  }
</style>
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span> Tutup</button>
    <h4 class="modal-title">Riwayat Perawatan</h4>
</div>
<div class="modal-body" style="margin-left:0;margin-right:0;padding-left:0;padding-right:0;">
  <div class="clearfix">
    <div class="col-md-12 col-lg-3">
        <div class="card profile-card">
            <div class="profile-header">&nbsp;</div>
            <div class="profile-body">
                <div class="image-area">
                    <div>
                      <img src="{$riwayat.fotoURL}" width="96" height="96" class="img-thumbnail" id="photoPreview" style="cursor:pointer;color:red;" onclick="$('input[name=photo]').click()" />
                      <input type="file" name="photo" class="form-control hidden" id="photo" />
                    </div>
                    <div id="uploadstatus"></div>
                    <h4>{$riwayat.pasien.nm_pasien}</h4>
                </div>
                <div class="content-area">
                    <p>{$riwayat.pasien.no_ktp}</p>
                    <p><span id="no_rkm_medis">{$riwayat.pasien.no_rkm_medis}</span></p>
                </div>
            </div>
            <div class="profile-footer visible-lg">
                <ul>
                    <li>
                        <span>Rawat Jalan</span>
                        <span>{$riwayat.count_ralan}</span>
                    </li>
                    <li>
                        <span>Rawat Inap</span>
                        <span>{$riwayat.count_ranap}</span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card card-about-me visible-lg">
            <div class="header">
                <h4>Detil Pribadi</h4>
            </div>
            <div class="body">
                <ul>
                    <li>
                        <div class="title">
                            <i class="fa fa-file-text"></i>
                            Alamat
                        </div>
                        <div class="content">
                            {$riwayat.pasien.alamat}
                        </div>
                    </li>
                    <li>
                        <div class="title">
                            <i class="fa fa-file-text"></i>
                            Jenis Kelamin
                        </div>
                        <div class="content">
                            {$riwayat.pasien.jk}
                        </div>
                    </li>
                    <li>
                        <div class="title">
                            <i class="fa fa-file-text"></i>
                            Tempat / Tanggal Lahir
                        </div>
                        <div class="content">
                            {$riwayat.pasien.tmp_lahir} / {$riwayat.pasien.tgl_lahir}
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-12 col-lg-9">
          <div class="panel-default panel-post">
          {if: !empty($riwayat.reg_periksa)}
            {loop: $riwayat.reg_periksa}
                <div class="panel-heading">
                    <div class="media">
                        <div class="media-body">
                            <h4 class="media-heading">
                                {$value.tgl_registrasi} / {$value.nm_poli}<span class="hidden-xs"> / {$value.png_jawab}</span>
                            </h4>
                            {$value.nm_dokter}
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="post">
                        {loop: $value.pemeriksaan_ralan as $data}
                        <div class="post-content">
                            <dl class="dl-horizontal no-margin">
                                <dt>Subjective</dt>
                                <dd>{$data.keluhan}</dd>
                                <dt>Objective</dt>
                                <dd>
                                  {if: !empty($data.pemeriksaan)}Pemeriksaan: {$data.pemeriksaan}<br>{/if}
                                  {if: !empty($data.suhu_tubuh)}Suhu: {$data.suhu_tubuh} &#8451;<br>{/if}
                                  {if: !empty($data.tensi)}Tekanan darah: {$data.tensi} mmHg<br>{/if}
                                  {if: !empty($data.nadi)}Nadi: {$data.nadi} x/menit<br>{/if}
                                  {if: !empty($data.respirasi)}RR: {$data.respirasi} x/menit<br>{/if}
                                  {if: !empty($data.tinggi)}Tinggi badan: {$data.tinggi} cm<br>{/if}
                                  {if: !empty($data.berat)}Berat badan: {$data.berat} kg<br>{/if}
                                  {if: !empty($data.gcs)}GCS: {$data.gcs}{/if}
                                </dd>
                                <dt>Assessment</dt>
                                <dd>
                                  <div class="clearfix">
                                    {$data.penilaian}
                                  </div>
                                </dd>
                                <dt>Plan</dt>
                                <dd>
                                  {if: !empty($data.rtl)}Tindak lanjut: {$data.rtl}<br>{/if}
                                  {if: !empty($data.catatan_perawatan)}Catatan Perawatan: {$data.catatan_perawatan}<br>{/if}
                                </dd>
                            </dl>
                        </div>
                        {/loop}
                        <div class="post-content">
                            <dl class="dl-horizontal no-margin">
                              {if: !empty($value.diagnosa_pasien)}
                                <div class="assessment-title">Diagnosa:</div>
                                <ul class="fa-ul">
                                {loop: $value.diagnosa_pasien as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_penyakit}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.prosedur_pasien)}
                                <div class="assessment-title">Prosedur:</div>
                                <ul class="fa-ul">
                                {loop: $value.prosedur_pasien as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.deskripsi_pendek}</li>
                                {/loop}
                                </ul>
                              {/if}
                            </dl>
                        </div>
                        <div class="post-content">
                            <dl class="dl-horizontal no-margin">
                              {if: !empty($value.rawat_jl_dr)}
                                <div class="assessment-title">Perawatan Ralan Dokter:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_jl_dr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.rawat_jl_drpr)}
                                <div class="assessment-title">Perawatan Ralan Dokter & Perawat:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_jl_drpr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.rawat_jl_pr)}
                                <div class="assessment-title">Perawatan Ralan Perawat:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_jl_pr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.rawat_inap_dr)}
                                <div class="assessment-title">Perawatan Ranap Dokter:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_inap_dr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.rawat_inap_drpr)}
                                <div class="assessment-title">Perawatan Ranap Dokter & Perawat:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_inap_drpr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                              {if: !empty($value.rawat_inap_pr)}
                                <div class="assessment-title">Perawatan Ranap Perawat:</div>
                                <ul class="fa-ul">
                                {loop: $value.rawat_inap_pr as $data}
                                  <li><i class="fa-li fa fa-check-square"></i>{$data.nm_perawatan}</li>
                                {/loop}
                                </ul>
                              {/if}
                            </dl>
                        </div>
                    </div>
                    {if: !empty($value.detail_pemberian_obat)}
                    <h4 style="background-color: #ddd;border-bottom: 2px #ccc solid;padding:5px;">Pemberian Obat</h4>
                    <div class="table-responsive no-margin">
                      <table class="table table-striped no-margin">
                        <thead>
                          <tr>
                            <th>Nama Obat</th>
                            <th>Jumlah</th>
                            <th>Aturan Pakai</th>
                          </tr>
                        </thead>
                        <tbody>
                            {loop: $value.detail_pemberian_obat as $data}
                            <tr>
                              <td>{$data.nama_brng}</td>
                              <td>{$data.jml}</td>
                              <td>{$data.aturan}</td>
                            </tr>
                            {/loop}
                        </tbody>
                      </table>
                    </div>
                    {/if}

                    {if: !empty($value.periksa_lab)}
                    <h4 style="background-color: #ddd;border-bottom: 2px #ccc solid;padding:5px;">Pemeriksaan Laboratorium Test</h4>
                    <div class="table-responsive no-margin">
                      <table class="table table-striped no-margin">
                        <thead>
                          <tr>
                            <th>Pemeriksaan</th>
                            <th>Nilai</th>
                            <th>Satuan</th>
                            <th>Nilai Rujukan</th>
                            <th>Keterangan</th>
                          </tr>
                        </thead>
                        <tbody>
                            {loop: $value.periksa_lab as $data1}
                            <tr>
                              <th colspan="5">{$data1.nm_perawatan}</th>
                            </tr>
                              {loop: $data1.detail_periksa_lab as $data2}
                              <tr>
                                <td>{$data2.Pemeriksaan}</td>
                                <td>{$data2.nilai}</td>
                                <td>{$data2.satuan}</td>
                                <td>{$data2.nilai_rujukan}</td>
                                <td>{?=nl2br($data2.keterangan)?}</td>
                              </tr>
                              {/loop}
                            {/loop}
                        </tbody>
                      </table>
                    </div>
                    {/if}
                    {if: !empty($value.gambar_radiologi)}
                    <h4 style="background-color: #ddd;border-bottom: 2px #ccc solid;padding:5px;">Gambar dan Hasil Radiologi</h4>
                    <div class="row">
                        <div class="gallery">
                        {loop: $value.gambar_radiologi as $data}
                            <div class="col-sm-6 col-md-6">
                                <div class="thumbnail">
                                    <a href="{?=WEBAPPS_URL.'/radiologi/'.$data.lokasi_gambar?}" class="gallery">
                                        <img src="{?=url(WEBAPPS_URL.'/radiologi/'.$data.lokasi_gambar)?}" class="img-responsive">
                                    </a>
                                </div>
                            </div>
                        {/loop}
                        </div>
                    </div>
                    {/if}
                    {if: $value.periksa_radiologi}
                    <div class="row">
                        <div class="col-sm-12 col-md-12">
                            {loop: $value.periksa_radiologi as $data}
                            <h4>{$data.nm_perawatan}</h4>
                            <div class="caption">
                                {?=nl2br($data.hasil)?}
                            </div>
                            {/loop}
                        </div>
                    </div>
                    {/if}
                  {if: !empty($value.berkas_digital)}
                  <h4 style="background-color: #ddd;border-bottom: 2px #ccc solid;padding:5px;">Berkas Digital</h4>
                  <div class="row">
                      <div class="gallery">
                      {loop: $value.berkas_digital as $data}
                          <div class="col-sm-6 col-md-6">
                              <div class="thumbnail">
                                  <a href="{?=url(WEBAPPS_URL.'/berkasrawat/'.$data.lokasi_file)?}" class="images">
                                      <img src="{?=url(WEBAPPS_URL.'/berkasrawat/'.$data.lokasi_file)?}" class="img-responsive">
                                  </a>
                              </div>
                          </div>
                      {/loop}
                      </div>
                  </div>
                  {/if}
                </div>
                <div class="panel-footer">
                    <ul>
                        <li class="hidden-xs">
                            {$value.status_lanjut}
                        </li>
                        <li>
                            {$value.status_bayar}
                        </li>
                        <li class="hidden-xs">
                            {$value.no_rawat}
                        </li>
                    </ul>
                </div>
          	  <div class="separator"> ##### </div>
            {/loop}
            {else}
            <div class="text-center">Tidak ditemukan riwayat perawatan</div>
          {/if}
          </div>
    </div>
  </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-primary" data-dismiss="modal">Tutup</button>
</div>
<script>
// Avatar
var reader  = new FileReader();
reader.addEventListener("load", function() {
  $("#photoPreview").attr('src', reader.result);
}, false);
$("input[name=photo]").change(function() {
  reader.readAsDataURL(this.files[0]);
});
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $(document).on('change','#photo',function(){
      var property = document.getElementById('photo').files[0];
      var image_name = property.name;
      var image_extension = image_name.split('.').pop().toLowerCase();

      if(jQuery.inArray(image_extension,['gif','jpg','jpeg','png']) == -1){
        alert("Invalid image file");
      }

      var form_data = new FormData();
      form_data.append("file",property);
      form_data.append("no_rkm_medis",$('#no_rkm_medis').text());
      $.ajax({
        url:'{?=url([ADMIN,'pasien','savephoto'])?}',
        method:'POST',
        data:form_data,
        contentType:false,
        cache:false,
        processData:false,
        beforeSend:function(){
          $('#photoPreview').hide();
          $('#uploadstatus').html('<img src="{?=url()?}/assets/img/loading.gif" height="100" width="100" />');
        },
        success:function(data){
          console.log(data);
          $('#uploadstatus').hide();
          $('#photoPreview').show();
          $('#photoPreview').html(data);
        }
      });
    });
  });
</script>
<script type="text/javascript">
  $('.images').lightbox();
</script>
